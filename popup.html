<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="js/jquery.autocomplete.min.js"></script>
<script type="text/javascript" src="js/playlist.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.autocomplete.css"/>
<style type="text/css">
#sidebar-tab{border:1px solid #ccf;margin-bottom:1.5em;}
#tab-title h3{color:#666;font-size:14px;font-weight:250;}
#tab-title .selected{color:#000000; font-weight:bold;} /*标题被选中时的样式*/
#tab-title span{padding:5px; padding-left:15px; border-right:0px;margin-left:-1px;cursor:pointer;}
#tab-content{border-top:1px solid #ccf;}
#tab-content .hide{display:none;} /*默认让第一块内容显示，其余隐藏*/
#tab-content ul{padding:3px 5px;overflow:hidden;}
.pager a{text-decoration:none;}
.pager {padding:5px;}


body,div,ul,ol,li,form{
padding:0px;margin:0px;
font:12px/20px arial, verdana, tahoma, simsun, '\5B8B\4F53', sans-serif;word-break:break-all;word-wrap:break-word;}
img{border:0;padding-right:10px}
ol,ul,dl{list-style:none;}
body {
  min-width:500px;
  height:450px;
  padding-left:20px;
  padding-right:20px;
  padding-top:10px;
  padding-bottom:10px;
 overflow-x:hidden;
}
.left{float:left;}
.right{float:right;}
.video{padding-top:5px;}
.clear{clear:both;}
.hits{color:#999999}
</style>
<script>
/*
//本地存数据
if(!localStorage.ct){
	localStorage.ct=0;
}
localStorage.ct++;
*/
chrome.tabs.getSelected(null, function (tab){

});
</script>
<script>
var i=0;
function showresult(resp){
	var r = eval(resp);
	if(r && r.result && r.result.length>0){
		
		$("#keywords").autocomplete(r.result,{
			autoFill:false,delay:100,
			formatItem: function(row, i, max) {
				return  "<div>"+row.keyword + " <span class='right hits'>[" + row.count + "]个视频</span></div>";
			},
			formatMatch: function(row, i, max) {
				return row.keyword;
			},
			formatResult: function(row) {
				return row.keyword;
			}
		});
	}
	
}

$("#keywords").ready(function(){
	$("#keywords").focus();
	if(localStorage.keywords)$("#keywords").val(localStorage.keywords)
	
	$("#keywords").keydown(function(){
		localStorage.keywords = $("#keywords").val();
		//$.get('http://tip.so.youku.com/search_keys?k='+$("#keywords").val()+'&type=video',showresult);
		$.getScript('http://tip.so.youku.com/search_keys?k='+$("#keywords").val()+'&type=video');
	});
	$("#keywords").result(function(event, data, formatted) {
		localStorage.keywords = data.keyword;
		//search();
	});
	
});

$("#search").ready(function(){
	$("#search_bt").click(function(){
		search();
	})
});
function search(page){
	page = page?page:1;
	var key = $("#keywords").val();
	$.getJSON("http://api.youku.com/api_ptvideo/st_3_pid_XOA?sv="+key+"&rt=3&ob=6&pz=4&pg="+page, function(data){
		$("#search").html("");
		 for(var i=0;i<data.item.length;i++){
					var ul = document.createElement("ul");

					var img = document.createElement("img");
					img.src = data.item[i].snapshot;
					//图标
					var li_img = document.createElement("li");
					li_img.appendChild(img);
					li_img.className="left clear";
					ul.appendChild(li_img);
					//连接
					var li_href = document.createElement("li");
					
					var a = document.createElement("a");
					a.href=data.item[i].link;//"http://v.youku.com/v_show/id_"+resp.results[i].videoid+".html";
					a.target="_blank";
					a.title=data.item[i].title;
					a.title = data.item[i].title;
					a.alt =data.item[i].title;
					a.innerHTML=data.item[i].title.substr(0,32);;
					li_href.appendChild(a);
					ul.appendChild(li_href);
					//会员
					var li_user = document.createElement("li");
					//li_user.className="right clear";
					var a = document.createElement("a");
					a.href="http://u.youku.com/user_show/id_"+data.item[i].author+".html";
					a.target="_blank";
					a.innerHTML=data.item[i].author;
					li_user.innerHTML="会员:";
					li_user.appendChild(a);
					ul.appendChild(li_user);
					//发布
					var li = document.createElement("li");
					//li.className="right clear";
					li.innerHTML="发布:"+data.item[i].pubDate;;
					ul.appendChild(li);
					//播放
					var li = document.createElement("li");
					//li.className="right clear";
					li.innerHTML="播放:"+data.item[i].playtimes;;
					ul.appendChild(li);
					//评论
					var li = document.createElement("li");
					//li.className="right clear";
					li.innerHTML="时长:"+data.item[i].duration;
					ul.appendChild(li);
					/*
					var img = document.createElement("img");
					li.appendChild(li_img);
					li.appendChild(li_a);
					*/
			
					document.getElementById("search").appendChild(ul);
					//clear
					var div_clear = document.createElement("div");
					div_clear.className="clear";
					document.getElementById("search").appendChild(div_clear);
		}
			//生成pager
		var pager="";
		if(data.pageNo>1){
			pager+="<a href='javascript:search(1);void(0)'>&lt;&lt;</a>&nbsp;";
			pager+="<a href='javascript:search("+(page-1)+");void(0)'>&lt;</a>&nbsp;";
		}else{
			pager+="&lt;&lt;&nbsp;&lt;&nbsp;";
		}
		data.totalPage = Math.ceil(data.totalSize/data.pageSize);
		var pageStart=(page-2>0)?(page-2):1;
		for(var i=pageStart;i<=data.totalPage&i<(page+3);i++){
			if(page==i){
			pager+=i+'&nbsp;';
			}else{
			pager+='<a href="javascript:search('+i+')">'+i+'</a>&nbsp;';
			}
		}
		if(data.totalPage>data.pageNo){
			pager+="<a href='javascript:search("+(page+1)+");void(0)'>&gt;</a>&nbsp;";
			pager+="<a href='javascript:search("+data.totalPage+");void(0)'>&gt;&gt;</a>&nbsp;";
		}else{
			pager+="&gt;&gt;&nbsp;&gt;&nbsp;";
		}
		$("#search_pager").html(pager);
	
	});
}


</script>
<title></title>
<body>

<div id="sidebar-tab">
	<div id="tab-title">

		<h3 class="left"><span class="selected">最新头条</span><span>历史记录</span><span>搜索结果</span></h3>
		
		<div style="padding-top:10px; padding-right:100px">
			<div><a href="http://www.youku.com" target="_blank"><img src="http://static.youku.com/v1.0.0572/index/img/logo_s.gif" /></a></div>
		</div>
		<div class="clear"></div>
	</div>
	<div id="tab-content">
		<div  id="videos"></div>
		<div class="hide">
			<div id="history">
			</div>
			<div id="history_pager" class="pager">
			</div>
		</div>
		<div class="hide">
			<div class="search" style="padding:5px">
				<form>
					<input type="text" size="50" id="keywords" value=""/>
					<input type="submit" id="search_bt" value="搜索"/>
				</form>
			</div>
			<div id="search"></div>
			<div id="search_pager" class="pager">
			</div>
		</div>
	</div>
</div>
<script>
$('#tab-title span').click(function(){
	$(this).addClass("selected").siblings().removeClass();
	$("#tab-content > div").slideUp('1000').eq($('#tab-title span').index(this)).slideDown('1000');
});
</script>


<div style="color: #909090;">Copyright&copy;2010 优酷 youku.com 版权所有<div>


<script>
function getHistory(page){
	var pageSize=15;
	var data = playlist.get(page,pageSize);
	$("#history").html("");
	for(var i=0;i<data.items.length;i++){
				var ul = document.createElement("ul");
				//连接
				var li_href = document.createElement("li");
				
				li_href.className="left ";
				li_href.width="100%";
				var a = document.createElement("a");
				a.href=data.items[i].url;
				a.target="_blank";
				a.title=data.items[i].title;
				a.title = data.items[i].title;
				a.alt =data.items[i].title;
				a.innerHTML=data.items[i].title.substr(0,38);;
				li_href.appendChild(a);
				ul.appendChild(li_href);
				var li = document.createElement("li");
				//li.className="right clear";
				li.innerHTML="&nbsp;&nbsp;(观看次数:"+data.items[i].ct+")";
				ul.appendChild(li);
				/*
				var img = document.createElement("img");
				li.appendChild(li_img);
				li.appendChild(li_a);
				*/
		
				document.getElementById("history").appendChild(ul);
				//clear
				var div_clear = document.createElement("div");
				div_clear.className="clear";
				document.getElementById("history").appendChild(div_clear);
	}
	//生成pager
	var pager="";
	if(data.page>1){
		pager+="<a href='javascript:getHistory(1);void(0)'>&lt;&lt;</a>&nbsp;";
		pager+="<a href='javascript:getHistory("+(page-1)+");void(0)'>&lt;</a>&nbsp;";
	}else{
		pager+="&lt;&lt;&nbsp;&lt;&nbsp;";
	}
	
	var pageStart=(page-2>0)?(page-2):1;
	for(var i=pageStart;i<=data.totalPage&i<(page+3);i++){
		if(page==i){
		pager+=i+'&nbsp;';
		}else{
		pager+='<a href="javascript:getHistory('+i+')">'+i+'</a>&nbsp;';
		}
	}
	if(data.totalPage>data.page){
		pager+="<a href='javascript:getHistory("+(page+1)+");void(0)'>&gt;</a>&nbsp;";
		pager+="<a href='javascript:getHistory("+data.totalPage+");void(0)'>&gt;&gt;</a>&nbsp;";
	}else{
		pager+="&gt;&gt;&nbsp;&gt;&nbsp;";
	}
	$("#history_pager").html(pager);
}
getHistory(1);
</script>
<script>
//search tips

try{
chrome.browserAction.setBadgeText({text:""});
}catch(e){}
$.getJSON('http://api.youku.com/api_getIndexRecVideos?pid=XOA&pd=1&recommend_type=head&pl=4', function(resp){

	var ct = resp.results.length;
	try{
	for (var i = 0; i<ct; i++) {
		var ul = document.createElement("ul");

		var img = document.createElement("img");
		img.src = resp.results[i].thumburl;
		//图标
		var li_img = document.createElement("li");
		li_img.appendChild(img);
		li_img.className="left clear";
		ul.appendChild(li_img);
		//连接
		var li_href = document.createElement("li");
		
		//li_href.className="right clear";
		var a = document.createElement("a");
		a.href="http://v.youku.com/v_show/id_"+resp.results[i].videoid+".html";
		a.target="_blank";
		a.title=resp.results[i].desc;
		a.title = resp.results[i].title;
		a.alt = resp.results[i].title;
		a.innerHTML=resp.results[i].title.substr(0,32);;
		li_href.appendChild(a);
		ul.appendChild(li_href);
		//会员
		var li_user = document.createElement("li");
		//li_user.className="right clear";
		var a = document.createElement("a");
		a.href="http://u.youku.com/user_show/id_"+resp.results[i].username+".html";
		a.target="_blank";
		a.innerHTML=resp.results[i].username;
		li_user.innerHTML="会员:";
		li_user.appendChild(a);
		ul.appendChild(li_user);
		//发布
		var li = document.createElement("li");
		//li.className="right clear";
		li.innerHTML="发布:"+resp.results[i].createtime;;
		ul.appendChild(li);
		//播放
		var li = document.createElement("li");
		//li.className="right clear";
		li.innerHTML="播放:"+resp.results[i].total_vv;;
		ul.appendChild(li);
		//评论
		var li = document.createElement("li");
		//li.className="right clear";
		li.innerHTML="评论:"+resp.results[i].total_comment;;
		ul.appendChild(li);
		/*
		var img = document.createElement("img");
		li.appendChild(li_img);
		li.appendChild(li_a);
		*/

		document.getElementById("videos").appendChild(ul);
		//clear
		var div_clear = document.createElement("div");
		div_clear.className="clear";
		document.getElementById("videos").appendChild(div_clear);
	}
	}catch(e){alert(e.description);}

});

</script>
</body>
</html>